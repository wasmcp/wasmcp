/// Server-side MCP message handler.
///
/// Processes incoming messages from clients.
interface handler {
    use wasi:io/streams@0.2.8.{
        output-stream,
    };
    use mcp.{
        error-code,
    };
    use context.{
        transport-context,
    };
    use messages.{
        server-result,
        server-message,
    };

    /// Handle an incoming message from the client
    handle: func(
        ctx: transport-context,
        message: server-message,
    ) -> option<result<server-result, error-code>>;
}

/// Handles MCP tool calls
///
/// Spec: <https://modelcontextprotocol.io/specification/2025-06-18/server/tools>
interface tools-handler {
    use mcp.{
        error-code,
    };
    use context.{
        request-context,
    };
    use tools.{
        call-tool-request,
        call-tool-result,
        list-tools-request,
        list-tools-result,
    };

    /// List tools provided by this component.
    list-tools: func(
        ctx: request-context,
        request: list-tools-request,
    ) -> result<list-tools-result, error-code>;

    /// Execute a tool call. Return none for unrecognized tools.
    call-tool: func(
        ctx: request-context,
        request: call-tool-request,
    ) -> result<option<call-tool-result>, error-code>;
}

/// Handles MCP resources
///
/// Spec: <https://modelcontextprotocol.io/specification/2025-06-18/server/resources>
interface resources-handler {
    use mcp.{
        error-code,
    };
    use context.{
        request-context,
    };
    use resources.{
        list-resources-request,
        list-resources-result,
        read-resource-request,
        read-resource-result,
        list-resource-templates-request,
        list-resource-templates-result,
    };

    /// list resources provided by this component.
    list-resources: func(
        ctx: request-context,
        request: list-resources-request,
    ) -> result<list-resources-result, error-code>;

    /// read a resource by uri. return none for unrecognized uris.
    read-resource: func(
        ctx: request-context,
        request: read-resource-request,
    ) -> result<option<read-resource-result>, error-code>;

    /// list resource templates (rfc 6570 uri templates).
    list-resource-templates: func(
        ctx: request-context,
        request: list-resource-templates-request,
    ) -> result<list-resource-templates-result, error-code>;
}

/// Handles MCP prompts
///
/// Spec: <https://modelcontextprotocol.io/specification/2025-06-18/server/prompts>
interface prompts-handler {
    use mcp.{
        error-code,
    };
    use context.{
        request-context,
    };
    use prompts.{
        get-prompt-request,
        get-prompt-result,
        list-prompts-request,
        list-prompts-result,
    };

    /// List prompts provided by this component.
    list-prompts: func(
        ctx: request-context,
        request: list-prompts-request,
    ) -> result<list-prompts-result, error-code>;

    /// Get a prompt by name. Return none for unrecognized prompts.
    get-prompt: func(
        ctx: request-context,
        request: get-prompt-request,
    ) -> result<option<get-prompt-result>, error-code>;
}

/// Handle MCP completions
///
/// Spec: <https://modelcontextprotocol.io/specification/2025-06-18/server/utilities/completion>
interface completions-handler {
    use mcp.{
        error-code,
    };
    use context.{
        request-context,
    };
    use completions.{
        complete-request,
        complete-result,
    };

    /// Provide completion suggestions for prompt or resource arguments.
    /// Return none for unsupported references.
    complete: func(
        ctx: request-context,
        request: complete-request,
    ) -> result<option<complete-result>, error-code>;
}
