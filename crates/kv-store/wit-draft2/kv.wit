package wasmcp:storage@0.1.0;

/// Generic key-value storage interface
///
/// Provides a thin abstraction over wasi:keyvalue that allows components
/// to use KV storage without coupling to specific wasi:keyvalue versions.
interface kv {
    /// A bucket is a collection of key-value pairs
    resource bucket {
        /// Get value by key
        ///
        /// Returns None if key does not exist
        get: func(key: string) -> result<option<list<u8>>, string>;

        /// Set key-value pair
        ///
        /// Creates or updates the key
        set: func(key: string, value: list<u8>) -> result<_, string>;

        /// Delete key
        ///
        /// No error if key does not exist
        delete: func(key: string) -> result<_, string>;

        /// Check if key exists
        exists: func(key: string) -> result<bool, string>;
    }

    /// Open or create a bucket
    ///
    /// The identifier is passed to the underlying KV implementation
    open: func(identifier: string) -> result<bucket, string>;
}
