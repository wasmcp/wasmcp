/// MCP server-side handler interface and composition worlds.
///
/// <https://modelcontextprotocol.io>
package wasmcp:server@0.1.0-beta.3;

/// Server-side MCP message handler.
@since(version = 0.1.0-alpha.8)
interface handler {
    use notifications.{
        notification-channel,
    };
    use wasmcp:protocol/mcp@0.1.0-beta.3.{
        error-code,
        claims,
        session-id,
        request-id,
        server-response,
        client-request,
        client-response,
        client-notification,
    };
    use server-messages.{
        context,
    };

    /// Handle a client request.
    ///
    /// Processes an MCP request from the client and returns a response.
    ///
    /// Parameters:
    /// - `ctx`: Context from transport (auth, session, custom metadata)
    /// - `request`: Tuple of (request body, request ID for correlation)
    /// - `channel`: Optional notification channel for sending notifications back to client
    ///
    /// Returns the server response or an error code if processing fails.
    @since(version = 0.1.0-alpha.8)
    handle-request: func(
        ctx: context,
        request: tuple<client-request, request-id>,
        channel: option<borrow<notification-channel>>,
    ) -> result<server-response, error-code>;

    /// Handle a client response to a server-initiated request.
    @since(version = 0.1.0-alpha.8)
    handle-response: func(
        ctx: context,
        response: result<tuple<client-response, request-id>, error-code>,
    );

    /// Handle a client notification.
    @since(version = 0.1.0-alpha.8)
    handle-notification: func(
        ctx: context,
        notification: client-notification,
    );
}

/// Server transport world.
///
/// Import handler interface to delegate MCP message processing.
@since(version = 0.1.0-alpha.8)
world transport {
    import handler;
}

/// Server middleware world.
///
/// Import and export handler interface to enable composition.
@since(version = 0.1.0-alpha.8)
world middleware {
    import handler;
    export handler;
}
